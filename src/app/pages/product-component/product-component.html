 <router-outlet/>

<mat-form-field appearance="fill" class="w-full sm:w-1/2 md:w-1/3 lg:w-1/4">
  <mat-label>Filtrar Productos</mat-label>
  <input matInput (keyup)="applyFilter($event)" placeholder="Ej. Acetaminofén o Familia A" #input>
  <mat-icon matSuffix>search</mat-icon>
</mat-form-field>

<div class="mat-elevation-z8 overflow-x-auto">
  <table mat-table [dataSource]="dataSource" matSort>

    <!-- ID Column (Oculta, pero útil para ordenar) -->
    <ng-container matColumnDef="idProduct">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> ID </th>
      <td mat-cell *matCellDef="let row"> {{row.idProduct}} </td>
    </ng-container>

    <!-- Name Column -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> NOMBRE </th>
      <td mat-cell *matCellDef="let row"> {{row.name}} </td>
    </ng-container>

    <!-- Descripcion Column -->
    <ng-container matColumnDef="descripcion">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> DESCRIPCIÓN </th>
      <td mat-cell *matCellDef="let row"> {{row.description}} </td>
    </ng-container>
    
    <!-- Presentation Column -->
    <ng-container matColumnDef="presentation">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> PRESENTACIÓN </th>
      <td mat-cell *matCellDef="let row"> {{row.presentation}} </td>
    </ng-container>

    <!-- UnitPrice Column -->
    <ng-container matColumnDef="unitPrice">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> PRECIO UNITARIO </th>
      <td mat-cell *matCellDef="let row"> {{row.unitPrice | currency}} </td>
    </ng-container>

    <!-- Stock Column -->
    <ng-container matColumnDef="stock">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> STOCK </th>
      <td mat-cell *matCellDef="let row"> {{row.stock}} </td>
    </ng-container>

    <!-- Expired Date Column -->
    <ng-container matColumnDef="expired">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> FECHA EXP. </th>
      <td mat-cell *matCellDef="let row"> {{row.expired | date: 'yyyy-MM-dd'}} </td>
    </ng-container>

    <!-- Category Name Column (Datos anidados) -->
    <ng-container matColumnDef="categoryName">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> CATEGORÍA </th>
      <td mat-cell *matCellDef="let row"> {{row.category?.name || 'N/A'}} </td>
    </ng-container>

    <!-- Family Name Column (Datos anidados) -->
    <ng-container matColumnDef="familyName">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> FAMILIA </th>
      <td mat-cell *matCellDef="let row"> {{row.family?.name || 'N/A'}} </td>
    </ng-container>

    <!-- Laboratory Name Column (Datos anidados) -->
    <ng-container matColumnDef="laboratoryName">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> LABORATORIO </th>
      <td mat-cell *matCellDef="let row"> {{row.laboratory?.name || 'N/A'}} </td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef> ACCIONES </th>
      <td mat-cell *matCellDef="let row">
        <button mat-icon-button color="primary" [routerLink]="['edit', row.idProduct]" title="Editar Producto">
          <mat-icon>edit</mat-icon>
        </button>
        <button mat-icon-button color="warn" (click)="delete(row.idProduct)" title="Eliminar Producto">
          <mat-icon>delete</mat-icon>
        </button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="getDisplayedColumns()"></tr>
    <tr mat-row *matRowDef="let row; columns: getDisplayedColumns();"></tr>

    <!-- Fila de Mensaje de No Hay Datos -->
    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell text-center" [attr.colspan]="getDisplayedColumns().length">
        No se encontraron productos que coincidan con el filtro "{{input.value}}"
      </td>
    </tr>
  </table>
</div>

<mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Seleccionar página de productos"></mat-paginator>

<!-- Botón para crear nuevo producto -->
<button mat-fab color="accent" style="position: fixed; bottom: 20px; right: 20px;" routerLink="/pages/product/new" title="Agregar Nuevo Producto"> 
    <mat-icon>add</mat-icon>
</button>
